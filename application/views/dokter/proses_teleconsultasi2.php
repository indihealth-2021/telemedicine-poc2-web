<style>
    .images-upload > input{
        display: none;
    }
    .images-upload > img{
        cursor: pointer;
    }
</style>
<div class="page-wrapper">
            <div class="content">
                <div class="row">
                    <div class="col-sm-12">
                        <h4 class="page-title">Proses Telekonsultasi</h4>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="blog-view">
                            <div class="card-box">
                                <h4>Pasien</h4><br>
                                <div class="form-group row">
                                    <label for="" class="col-4 col-form-label" style="padding-left: 35px"><b>Nama :</b></label>
                                    <div class="col-8">
                                        <input type="text" readonly class="form-control-plaintext" id="" value="nama" name="">
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <label for="" class="col-4 col-form-label" style="padding-left: 35px"><b>Usia :</b></label>
                                    <div class="col-8">
                                        <input type="text" readonly class="form-control-plaintext" id="" value="usia" name="">
                                    </div>
                                </div>
                            </div>
                            <div class="card-box">
                                <h4>Assesment Pasien</h4><br>
                                <div class="col-sm-12 row">
                                    <div class="col-md-6">
                                        <div class="form-group form-focus">
                                                  <label class="focus-label">Berat Badan</label>
                                                  <input type="text" class="form-control floating">
                                            <label for="" class="col-3 form-label text-primary">Kg</label>
                                          </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group form-focus">
                                                  <label class="focus-label">Tinggi Badan</label>
                                                  <input type="text" class="form-control floating">
                                            <label for="" class="col-3 form-label text-primary">Cm</label>
                                          </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group form-focus">
                                                  <label class="focus-label">Tekanan Darah</label>
                                                  <input type="text" class="form-control floating">
                                            <label for="" class="col-3 form-label text-primary">mmHg</label>
                                          </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group form-focus">
                                                  <label class="focus-label">Suhu Tubuh</label>
                                                  <input type="text" class="form-control floating">
                                            <label for="" class="col-3 form-label text-primary">Celcius</label>
                                          </div>
                                    </div>
                                    <div class="col-md-12">
                                    <hr>
                                        <div class="form-group">
                                            <label for="" class="col-5 col-form-label">Merokok</label>
                                            <label class="radio-inline" style="padding-right: 72px">
                                                <input required type="radio" name="merokok" id="optionsRadiosInline1" value=1> Ya 
                                            </label>
                                            <label class="radio-inline">
                                                <input required type="radio" name="merokok" id="optionsRadiosInline2" value=0 > Tidak
                                            </label>
                                        </div>
                                        <hr>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label for="" class="col-5 col-form-label">Minum Alkohol</label>
                                            <label class="radio-inline" style="padding-right: 72px">
                                                <input required type="radio" name="merokok" id="optionsRadiosInline1" value=1> Ya 
                                            </label>
                                            <label class="radio-inline">
                                                <input required type="radio" name="merokok" id="optionsRadiosInline2" value=0 > Tidak
                                            </label>
                                        </div>
                                        <hr>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label for="" class="col-5 col-form-label">Kecelakaan</label>
                                            <label class="radio-inline" style="padding-right: 40px">
                                                <input required type="radio" name="merokok" id="optionsRadiosInline1" value=1> Pernah 
                                            </label>
                                            <label class="radio-inline">
                                                <input required type="radio" name="merokok" id="optionsRadiosInline2" value=0 > Tidak Pernah
                                            </label>
                                        </div>
                                        <hr>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label for="" class="col-5 col-form-label">Di Rawat</label>
                                            <label class="radio-inline" style="padding-right: 40px">
                                                <input required type="radio" name="merokok" id="optionsRadiosInline1" value=1> Pernah 
                                            </label>
                                            <label class="radio-inline">
                                                <input required type="radio" name="merokok" id="optionsRadiosInline2" value=0 > Tidak Pernah
                                            </label>
                                        </div>
                                        <hr>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label for="" class="col-5 col-form-label">Operasi</label>
                                            <label class="radio-inline" style="padding-right: 40px">
                                                <input required type="radio" name="merokok" id="optionsRadiosInline1" value=1> Pernah 
                                            </label>
                                            <label class="radio-inline">
                                                <input required type="radio" name="merokok" id="optionsRadiosInline2" value=0 > Tidak Pernah
                                            </label>
                                        </div>
                                        <hr>
                                    </div>
                                    <div class="col-md-12 mb-25">
                                        <div class="form-group row mb-5">
                                            <label class="col-form-label col-md-2">Keluhan</label>
                                            <div class="col-md-10 mb-5">
                                                <textarea rows="5" cols="5" class="form-control" placeholder="Enter text here"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <aside class="col-md-6">
                        <div class="card-box">
                            <h4 class="mb-3">Proses Telekonsultasi</h4>
                                 <button type="button" data-toggle="modal" data-target="#exampleModal" class="btn btn-primary" id="panggil" data-id-pasien="<?php echo $pasien->id ?>" data-id-jadwal-konsultasi="<?php echo $id_jadwal_konsultasi ?>">Panggil</button> 
                                <button type="button" class="btn btn-primary" id="btn-stop" data-id-jadwal-konsultasi='<?php echo $id_jadwal_konsultasi ?>' data-id-pasien="<?php echo $pasien->id ?>">Selesai</button> 
                            <!-- Modal -->
                                <div class="modal fade" id="memanggil" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered" style="width: 300px">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalLabel">Memanggil...</h5>
                                            <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button> -->
                                        </div>
                                        <div class="modal-body" align="center">
                                        <i class="fa fa-phone fa-5x" style="color: #007Bff;">....</i>
                                        </div>
                                        <div class="modal-footer">
                                        <button type="button" class="btn btn-danger" data-dismiss="modal">Tutup</button>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                            <!--modal-->
                            <ul class="nav nav-tabs nav-tabs-bottom">
                                <li class="nav-item"><a class="nav-link active" href="#bottom-tab1" data-toggle="tab"><i class="fa fa-comments"></i> Chat</a></li>
                                <li class="nav-item"><a class="nav-link" href="#bottom-tab2" data-toggle="tab"><i class="fa fa-video-camera"></i> Video Conference</a></li>
                            </ul>

                            <div class="tab-content">
                                <div class="tab-pane show active" id="bottom-tab1">
                                    <div class="col-md-12">
                                        <div class="col-lg-9 message-view chat-view">
                                            <div class="chat-window">
                                                <div class="fixed-header">
                                                    <div class="navbar row">
                                                        <div class="user-details mr-auto">
                                                            <div class="float-left user-img m-r-10">
                                                            <?php 
                                                                if($pasien->foto){
                                                                    $foto = base_url('assets/images/users/'.$pasien->foto);
                                                                }
                                                                else{
                                                                    $foto = base_url('assets/telemedicine/img/default.png');
                                                                }
                                                            ?>
                                                                <a href="#" title="<?php echo $pasien->name ?>"><img src="<?php echo $foto;?>" alt="" class="w-40 rounded-circle"><!--<span class="status online"></span>--></a>
                                                            </div>
                                                            <div class="user-info float-left">
                                                                <a href="#"><span class="font-bold"><?php echo $pasien->name ?></span> <!--<i class="typing-text">Typing...</i>--></a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-box">
                                                    <div class="chat-contents chat-content-wrap">
                                                        <div class="chat-wrap-inner">
                                                            <div class="chat-box">
                                                                <div class="chats" id="messages">
                                                                    <!--<div class="chat chat-right">
                                                                        <div class="chat-body">
                                                                            <div class="chat-bubble">
                                                                                <div class="chat-content">
                                                                                    <p>Hello. What can I do for you?</p>
                                                                                    <span class="chat-time">8:30 am</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="chat-line">
                                                                        <span class="chat-date">October 8th, 2015</span>
                                                                    </div>
                                                                    <div class="chat chat-right">
                                                                        <div class="chat-body">
                                                                            <div class="chat-bubble">
                                                                                <div class="chat-content">
                                                                                    <p>Where?</p>
                                                                                    <span class="chat-time">8:35 am</span>
                                                                                </div>
                                                                            </div>
                                                                            <div class="chat-bubble">
                                                                                <div class="chat-content">
                                                                                    <p>OK, my name is Limingqiang. I like singing, playing basketballand so on.</p>
                                                                                    <span class="chat-time">8:42 am</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="chat chat-left">
                                                                        <div class="chat-avatar">
                                                                            <a href="#" class="avatar">
                                                                                <img alt="<?php //echo $pasien->name ?>" src="<?php //echo base_url('assets/dashboard/img/patient-thumb-02.jpg');?>" class="img-fluid rounded-circle">
                                                                            </a>
                                                                        </div>
                                                                        <div class="chat-body">
                                                                            <div class="chat-bubble">
                                                                                <div class="chat-content img-content">
                                                                                    <div class="chat-img-group clearfix">
                                                                                        <p>Uploaded 3 Images</p>
                                                                                        <a class="chat-img-attach" href="#">
                                                                                            <img width="182" height="137" alt="" src="assets/img/placeholder.jpg">
                                                                                            <div class="chat-placeholder">
                                                                                                <div class="chat-img-name">placeholder.jpg</div>
                                                                                                <div class="chat-file-desc">842 KB</div>
                                                                                            </div>
                                                                                        </a>
                                                                                        <a class="chat-img-attach" href="#">
                                                                                            <img width="182" height="137" alt="" src="assets/img/placeholder.jpg">
                                                                                            <div class="chat-placeholder">
                                                                                                <div class="chat-img-name">842 KB</div>
                                                                                            </div>
                                                                                        </a>
                                                                                        <a class="chat-img-attach" href="#">
                                                                                            <img width="182" height="137" alt="" src="assets/img/placeholder.jpg">
                                                                                            <div class="chat-placeholder">
                                                                                                <div class="chat-img-name">placeholder.jpg</div>
                                                                                                <div class="chat-file-desc">842 KB</div>
                                                                                            </div>
                                                                                        </a>
                                                                                    </div>
                                                                                    <span class="chat-time">9:00 am</span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>-->
                                                                    
                                                                </div>
                                                                </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="chat-footer">
                                                                    <form id="form-message" enctype="multipart/form-data">
                                                                        <div class="message-bar">
                                                                            <div class="message-inner">
                                                                                <label class="images-upload">
                                                                                    <img src="<?php echo base_url('assets/dashboard/img/attachment.png');?>" alt=""> 
                                                                                    <input id="attachment_label"  type="file" name="attachment" accept=".jpg,.jfif,.jpeg,.png,.txt,.docx,.doc,.pdf">
                                                                                </label>
                                                                                <div class="message-area">
                                                                                    <div class="input-group">
                                                                                        <textarea class="form-control" name="message" placeholder="Type message..."></textarea>
                                                                                        <span class="input-group-append">
                                                                                            <button class="btn btn-primary" id="send"><i class="fa fa-send"></i></button>
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                                <div class="row">
                                                                                    <div class="col-9" id="attachment_name">
                                                                                        
                                                                                    </div>
                                                                                </div>
                                                                    </div>
                                                                    </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane mb-3" id="bottom-tab2">
                                    <div class="col-md-12">
                                        <div id="meet" width="470" height="500" style="background: #000;"></div>                                
                                            <!-- <video autoplay id="video-other" style="background-color: #000;" width="100%" height="100%"></video>                  
                                          <video autoplay id="video-ku" style="background-color: #000; position: absolute; bottom: 75px; right: 8px; width: 40%; height: 40%;"></video> -->                
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <div class="card-box">
                            <h4 class="mb-4">Diagnosa</h4>
                            <div class="col-md-12">
                                <div class="form-group row">
                                    <div class="col-md-12">
                                        <textarea class="form-control" rows="3" placeholder="diagnosa dokter" name="diagnosis"><?php if($diagnosis){ echo $diagnosis->diagnosis; } ?></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12 row">
                                <h4 class="mb-4 col-md-6">Resep</h4>    
                                <div class="col-md-3">
                                    <button type="button" class="btn btn-light btn-sm" id="remove"><i class="fa fa-minus" style="color: #009EFB">HAPUS</i></button>    
                                </div>
                                <div class="col-md-3" style="float: right">
                                    <button type="button" class="btn btn-light btn-sm" id="add"><i class="fa fa-plus" style="color: #009EFB;">TAMBAH</i></button> 
                                </div>
                                <div class="col-sm-12">
                                    <hr>
                                  <div class="form-group resep-dokter" id="resepDokter">
                                       <div class="row">
                                           <div class="col-sm-5">
                                          <?php foreach($list_obat as $obat){ ?>
                                              <div id="obat-<?php echo $obat->id ?>" style="display: none"><?php echo $obat->unit ?></div>
                                            <?php } ?>
                                              <select name="id_obat[]" id="obat" class="form-control form-control-sm" onchange="obat_onchange();">
                                                    <?php foreach($list_obat as $obat){ ?>
                                              <option value="<?php echo $obat->id ?>"><?php echo $obat->name ?></option>
                                                    <?php } ?>
                                              </select>
                                           </div>
                                           <div class="col-sm-3">
                                                <input type="number" min=1 max=100 name="jumlah_obat[]" class="form-control form-control-sm" id="unit" placeholder="Jml">
                                           </div>
                                           <div class="col-sm-4">
                                                <input type="text" name="keterangan[]" class="form-control form-control-sm" placeholder="Aturan Minum">
                                           </div>
                                         </div>
                                    </div>
                                    <input type="hidden" name="id_pasien" value=<?php echo $pasien->id ?>>
                                    <input type="hidden" name="id_jadwal_konsultasi" value=<?php echo $id_jadwal_konsultasi ?>>
                                </div>
                            </div>
                        </div>
                    </aside>
                </div>
            </div>


              <script type="text/javascript">      
    function makeid(length) {
      var result           = '';
      var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      var charactersLength = characters.length;
      for ( var i = 0; i < length; i++ ) {
          result += characters.charAt(Math.floor(Math.random() * charactersLength));
      }
      return result;
    }
   var uniqid = makeid(12);
   reg_id = '<?php echo $pasien->reg_id;?>';
   name = '<?php echo $user->name;?>';  
   var room_name = 'telemedicine_lintas_'+<?php echo $id_jadwal_konsultasi ?>+'_'+<?php echo $user->id ?>+'_'+uniqid;

   document.getElementById("user-call").value='<?php echo $pasien->id ?>';  
   var userName = name;
   const domain = 'telekonsultasi.indihealth-rtc.xyz';
   const options = {
    roomName: room_name,
    width: 470,
    height: 500,  
    parent: undefined,
    parentNode: document.querySelector('#meet')
};
const api = new JitsiMeetExternalAPI(domain, options);
 api.executeCommand('displayName', userName);
 api.addEventListener('participantRoleChanged', function (event) {
    if(event.role === 'moderator') {
        api.executeCommand('toggleLobby', true);
    }
});
 api.on('passwordRequired', function ()
{
    api.executeCommand('password', '123456');
});
  </script>
<script type="text/javascript" src="<?php echo base_url('assets/js/conference.js');?>"></script> 
<?php $foto_pasien = $pasien->foto ? base_url('assets/images/users/'.$pasien->foto) : base_url('assets/telemedicine/img/default.png'); ?>
<?php $foto_dokter = $user->foto ? base_url('assets/images/users/'.$user->foto) : base_url('assets/telemedicine/img/default.png'); ?>
<script>
chat_locate = 'dokter';
user_kategori = 'dokter';
id_pasien = <?php echo $pasien->id ?>;
id_dokter = <?php echo $user->id ?>;
foto_pasien = '<?php echo $foto_pasien ?>';
foto_dokter = '<?php echo $foto_dokter ?>';

</script>
<script>
  function resizeInput(){
    $(this).attr('size', $(this).val().length);
  }
  $('input[type="text"]')
  .keyup(resizeInput)
  .each(resizeInput);

  $('input[type="number"]')
  .keyup(resizeInput)
  .each(resizeInput);
</script>

<script>
function obat_onchange(){
  var obat = document.getElementById('obat');
  var satuan = document.getElementById('obat-'+obat.value);
  
  var satuan_show = document.getElementById('unit');

  satuan_show.placeholder = "Jml ("+satuan.innerHTML+")";
}
</script>

<div id="share_files" class="modal fade" role="dialog">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title">Share File</h3>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="files-share-list">
                                <div class="files-cont">
                                    <div class="file-type">
                                        <span class="files-icon"><i class="fa fa-file-pdf-o"></i></span>
                                    </div>
                                    <div class="files-info">
                                        <span class="file-name text-ellipsis">AHA Selfcare Mobile Application Test-Cases.xls</span>
                                        <span class="file-author"><a href="#">Bernardo Galaviz</a></span> <span class="file-date">May 31st at 6:53 PM</span>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Share With</label>
                                <input class="form-control" type="text">
                            </div>
                            <div class="m-t-50 text-center">
                                <button class="btn btn-primary submit-btn">Share</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar-overlay" data-reff=""></div>